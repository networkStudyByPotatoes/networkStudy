# 6장_스위치를 켜라!

### 🔎 맥어드레스는 어디에 저장 되어있을까?

맥 어드레스는 스위치나 브리지가 출발지에서 들어오는 맥 어드레스를 보고 자신의 맥 어드레스 테이블에 저장한 후 그 주소 테이블에 있는 맥 어드레스를 찾으면 그쪽 포트로만 보내고 나머지 포트는 막아줌으로써 스위치의 기본 기능 중 하나인 콜리전 도메인을 막는 역할을 수행합니다.

- Dynamic 방식

    맥 어드레스를 하나 배우고 나면, 그것을 맥 어드레스 테이블에 저장하고 사용합니다. 이때 이 주소를 사용한 지 300초가 지나도록 다시 사용하지 않으면 이 주소는 MAC 테이블에서 지워집니다. MAC 테이블은 그 용량에 한계가 있기에 시간이 지나면 지워지게 됩니다.

- Permanent 방식

    맥 어드레스를 지워지지 않게 저장하는 방법이 있는데 이때 사람이 수동으로 맥 어드레스를 넣어줍니다.

`스태틱 맥 어드레스` : 항상 맥 어드레스 테이블에 저장되어 지워지는 일이 없는 주소를 의미하며, 이 맥 어드레스를 알기 위해 Learning 과정을 거칠 필요가 없는 장점이 있지만 주소가 바뀐다고 해도 자동으로 수정이 불가능하고 맥 어드레스 테이블을 계속 사용하기 때문에 메모리가 낭비 된다는 단점이 존재합니다.


### 🔎 가상의 랜 (Virtual LAN)?

LAN을 사용하면 한 대의 스위치를 마치 여러대의 분리된 스위치처럼 사용하고, 또 여러 개의 네트워크 정보를 하나의 포트를 통해 전송할 수 있습니다. 또한 가상 랜을 통해 하나의 스위치에 연결된 장비들도 브로드캐스트 도메인이 서로 다를 수 있습니다.

VLAN은 한 대의 스위치를 여러 개의 네트워크로 나누기 위해서 사용하며, 스위치가 VLAN으로 나누어지면 나누어진 VLAN 간의 통신은 오직 라우터를 통해서만 가능합니다. 

`트렁크 포트` : 하나의 포트를 통해 서로 다른 여러 개의 VLAN을 전송할 수 있게 하는 포트

트렁크에서 패킷이 전송될 때 패킷에 VLAN 정보도 같이 전송됩니다. 이로 인해 어느 VLAN에 속한 패킷인지를 목적지에서 구분할 수 있습니다.

### 🔎 가상의 랜 (Virtual LAN)에서의 트렁킹과 VTP ?

- ISL 트렁킹 방식

    시스코에서 만든 트렁킹 프로토콜로, 시스코 장비끼리만 사용하는 방식, 스위치와 스위치 간의 링크 스위치와 라우터 간의 링크에서 여러 개의 VLAN 정보를 함께 전달하는 방식입니다.

- IEEE 802.1Q 트렁킹 방식

    트렁킹에 대한 표준 프로토콜


`트렁킹` : 여러 개의 VLAN을 한 번에 전송하는 방식

`VTP` : 스위치들 간에 VLAN 정보를 서로 주고받아 스위치들이 가지고 있는 VLAN 정보를 항상 일치시켜 주기 위한 프로토콜

### 1. 주고 받는 메시지

- `Summary Advertisement` : VTP 서버가 자기에게 연결되어 있는 스위치들에게 5분마다 한 번씩 전달하는 메시지로, 자신이 관리하는 VTP 도메인 구성에 대한 Revision 넘버를 보냅니다. 스위치들은 바로 이 넘버를 통해 자신들의 VLAN 정보에 대한 최신 유무를 판단합니다.

- `Subset Advertisement` : VLAN의 구성이 변경되었을 때나 VTP 클라이언트로부터 Advertisement Request 메시지를 받았을 때 전송됩니다.

- `Advertisement Request` : 클라이언트가 VTP 서버에 Summary Advertisement와 Subset Advertisement를 요청하는 용도로 사용됩니다.

#### 2. VTP 모드

- `서버 모드` : VLAN을 생성하고, 삭제하고, VLAN의 이름을 바꿔줄 수 있으며 VTP 도메인 안에 있는 나머지 스위치들에게 VTP 도메인 이름과 VLAN 구성, Configuration Revision 넘버를 전달해 줄 수 있습니다.

- `클라이언트 모드` : VLAN을 만들거나 삭제하고, VLAN 이름의 변경이 불가능하며 VTP 클라이언트는 VTP 서버가 전달해준 VLAN 정보를 받고 또 받은 정보를 자기와 연결된 다른 쪽 스위치에 전달하는 것만 가능합니다.

- `트랜스페어런트 모드` : VTP 도메인 영역 안에 있지만, 서버로부터 메시지를 받아 자신의 VLAN을 업데이트 하거나 자신의 VLAN을 업데이트한 정보를 다른 스위치에 직접 전달하지 않습니다. 


`VTP Pruning` : VLAN을 좀 더 효율적으로 사용하기 위해 만든 응용 기법이며, 트렁크로 이동하는 VLAN 트래픽 중에서 갈 필요가 없는 트렁크쪽으로 트래픽이 흘러갈 경우 잘라낸다라는 의미를 가지고 있습니다.




---